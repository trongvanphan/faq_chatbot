🎭 CONTEXT MANAGEMENT & MULTI-TURN CONVERSATION DEMO
This demo shows the difference between context-aware and context-unaware chatbots

================================================================================
📚 HOW CONTEXT MANAGEMENT WORKS - STEP BY STEP
================================================================================

1. Message Storage: Mỗi tin nhắn (user và bot) được lưu với timestamp
```
conversation_history = [
    {"role": "user", "content": "Gợi ý xe SUV", "timestamp": "2025-06-28T10:00:00"},
    {"role": "assistant", "content": "Honda CR-V, Toyota RAV4...", "timestamp": "2025-06-28T10:00:05"}
]```


2. Context Building: Khi có câu hỏi mới, toàn bộ lịch sử được gửi cho AI
```
messages = [
    {"role": "system", "content": "Bạn là trợ lý ô tô, nhớ cuộc trò chuyện..."},
    {"role": "user", "content": "Gợi ý xe SUV"},
    {"role": "assistant", "content": "Honda CR-V, Toyota RAV4..."},
    {"role": "user", "content": "Honda CR-V có ưu điểm gì?"}  # Câu hỏi mới
]```


3. Reference Resolution: AI hiểu 'Honda CR-V' được đề cập trong câu trả lời trước
```
# AI nhận được toàn bộ context nên biết:
# - Honda CR-V được đề cập trong response trước
# - User đang hỏi về xe đó cụ thể
# - Không cần tìm kiếm lại danh sách SUV```


4. Context Summary: Tóm tắt chủ đề để quản lý token limit
```
context_summary = "Đã tư vấn xe SUV | Quan tâm Honda CR-V"
# Giúp AI nhớ những gì quan trọng ngay cả khi conversation dài```

================================================================================
🚫 DEMO: WITHOUT Context Management (Current Implementation)
================================================================================

👤 Cuộc trò chuyện bắt đầu...

👤 User: Gợi ý xe SUV cho tôi
🔄 Calling OpenAI API...
🔧 Executing function: get_car_recommendations with args: {'car_type': 'suv'}
🔄 Getting final response...
🤖 Bot: Dưới đây là một số gợi ý xe SUV phổ biến tại Việt Nam mà bạn có thể tham khảo:

1. **Honda CR-V**
2. **Toyota RAV4**
3. **Mazda CX-5**
4. **Ford EcoSport**
5. **Hyundai Tucson**

Nếu bạn cần thêm thông tin về một mẫu xe cụ thể nào đó, hãy cho tôi biết!
📝 Context: Mỗi câu hỏi được xử lý độc lập - bot không nhớ gì!
------------------------------------------------------------
👤 User: Honda CR-V có ưu điểm gì?
🔄 Calling OpenAI API...
🤖 Bot: Xin lỗi, nhưng tôi chỉ có thể cung cấp thông tin liên quan đến ô tô. Bạn có thể hỏi về các loại xe, lịch bảo dưỡng, mẹo tiết kiệm nhiên liệu hoặc thông tin khác liên quan đến ô tô. Hãy cho tôi biết nếu bạn cần thông tin nào khác!
📝 Context: Mỗi câu hỏi được xử lý độc lập - bot không nhớ gì!
------------------------------------------------------------
👤 User: Giá của nó như thế nào?
🔄 Calling OpenAI API...
🤖 Bot: Xin lỗi, nhưng tôi chỉ có thể cung cấp thông tin liên quan đến ô tô. Bạn có thể hỏi về các loại xe, bảo dưỡng, mẹo tiết kiệm nhiên liệu hoặc thông tin khác liên quan đến ô tô. Hãy cho tôi biết bạn cần gì!
📝 Context: Mỗi câu hỏi được xử lý độc lập - bot không nhớ gì!
------------------------------------------------------------
👤 User: So với Toyota RAV4 thì sao?
🔄 Calling OpenAI API...
🤖 Bot: Xin lỗi, nhưng tôi không thể trả lời câu hỏi này nếu không có thêm thông tin về điều bạn muốn so sánh với Toyota RAV4. Bạn có thể hỏi về các loại xe khác, thông tin bảo trì, hoặc mẹo tiết kiệm nhiên liệu liên quan đến ô tô. Hãy cho tôi biết bạn cần gì!
📝 Context: Mỗi câu hỏi được xử lý độc lập - bot không nhớ gì!
------------------------------------------------------------

================================================================================
✅ DEMO: WITH Context Management (New Implementation)
================================================================================
🔄 Conversation context has been reset.

👤 Cuộc trò chuyện bắt đầu...

👤 User: Gợi ý xe SUV cho tôi
🔄 Processing question with 1 messages of context...
🔧 Executing function: get_car_recommendations with args: {'car_type': 'suv'}
🔄 Getting contextualized final response...
💭 Conversation context: {'session_id': 'session_20250628_112927', 'message_count': 4, 'context_summary': 'Đã tư vấn xe suv', 'last_topics': ['SUV']}
🤖 Bot: Dưới đây là một số gợi ý xe SUV phổ biến tại Việt Nam mà bạn có thể tham khảo:

1. **Honda CR-V**
2. **Toyota RAV4**
3. **Mazda CX-5**
4. **Ford EcoSport**
5. **Hyundai Tucson**

Nếu bạn cần thêm thông tin chi tiết về một mẫu xe nào đó, hãy cho tôi biết!
📝 Context: 4 tin nhắn, Topics: ['SUV']
💭 Summary: Đã tư vấn xe suv
------------------------------------------------------------
👤 User: Honda CR-V có ưu điểm gì?
🔄 Processing question with 5 messages of context...
🔧 Executing function: search_faq with args: {'query': 'Honda CR-V ưu điểm'}
🔄 Getting contextualized final response...
💭 Conversation context: {'session_id': 'session_20250628_112927', 'message_count': 8, 'context_summary': 'Đã tư vấn xe suv', 'last_topics': []}
🤖 Bot: Honda CR-V có một số ưu điểm nổi bật như sau:

1. **Không gian rộng rãi**: CR-V cung cấp không gian nội thất thoải mái cho cả hành khách và hàng hóa, rất phù hợp cho gia đình.

2. **Tiết kiệm nhiên liệu**: Mẫu xe này thường có mức tiêu thụ nhiên liệu thấp hơn so với nhiều đối thủ trong phân khúc SUV.

3. **Công nghệ an toàn**: Honda CR-V được trang bị nhiều tính năng an toàn hiện đại, bao gồm cả hệ thống hỗ trợ lái và cảnh báo va chạm.

4. **Hiệu suất vận hành**: Động cơ mạnh mẽ và hệ thống treo tốt giúp CR-V có khả năng vận hành ổn định trên nhiều loại địa hình.

5. **Giá trị bền vững**: Honda thường có giá trị bán lại cao, do đó CR-V là một lựa chọn đầu tư tốt.

Nếu bạn cần
📝 Context: 8 tin nhắn, Topics: []
💭 Summary: Đã tư vấn xe suv
------------------------------------------------------------
👤 User: Giá của nó như thế nào?
🔄 Processing question with 9 messages of context...
🔧 Executing function: search_faq with args: {'query': 'Honda CR-V giá'}
🔄 Getting contextualized final response...
💭 Conversation context: {'session_id': 'session_20250628_112927', 'message_count': 12, 'context_summary': 'Đã tư vấn xe suv', 'last_topics': []}
🤖 Bot: Giá của Honda CR-V có thể thay đổi tùy thuộc vào phiên bản và trang bị. Tại thị trường Việt Nam, giá bán của Honda CR-V thường dao động từ khoảng 1 tỷ đến 1.2 tỷ đồng, tùy vào các tùy chọn và chương trình khuyến mãi. 

Để có thông tin chính xác nhất, bạn nên tham khảo từ các đại lý Honda hoặc trang web chính thức của hãng. Nếu bạn cần tìm hiểu thêm về các phiên bản cụ thể hoặc thông tin khác, hãy cho tôi biết!
📝 Context: 12 tin nhắn, Topics: []
💭 Summary: Đã tư vấn xe suv
------------------------------------------------------------
👤 User: So với Toyota RAV4 thì sao?
🔄 Processing question with 13 messages of context...
💭 Conversation context: {'session_id': 'session_20250628_112927', 'message_count': 14, 'context_summary': 'Đã tư vấn xe suv', 'last_topics': []}
🤖 Bot: So với Toyota RAV4, Honda CR-V và Toyota RAV4 đều là những mẫu SUV rất phổ biến và có nhiều ưu điểm riêng. Dưới đây là một số điểm so sánh giữa hai mẫu xe này:

1. **Thiết kế**:
   - **Honda CR-V**: Có thiết kế hiện đại, tinh tế với nhiều đường nét mềm mại.
   - **Toyota RAV4**: Thiết kế mạnh mẽ, nam tính hơn với các đường nét góc cạnh.

2. **Không gian nội thất**:
   - **CR-V**: Thường được khen ngợi về không gian rộng rãi và thoải mái cho cả hành khách và hàng hóa.
   - **RAV4**: Cũng có không gian rộng rãi, nhưng có thể không thoải mái bằng CR-V ở hàng ghế sau.

3. **Tiết kiệm nhiên liệu**:
   - **CR-V**: Nổi
📝 Context: 14 tin nhắn, Topics: []
💭 Summary: Đã tư vấn xe suv
------------------------------------------------------------

================================================================================
🎯 DEMO: Context Management Features
================================================================================
🔄 Conversation context has been reset.

1. Remembering Previous Recommendations
----------------------------------------
🔄 Conversation context has been reset.
👤 Gợi ý xe sedan cho tôi
🔄 Processing question with 1 messages of context...
🔧 Executing function: get_car_recommendations with args: {'car_type': 'sedan'}
🔄 Getting contextualized final response...
💭 Conversation context: {'session_id': 'session_20250628_112927', 'message_count': 4, 'context_summary': 'Đã tư vấn xe sedan', 'last_topics': ['Sedan']}
🤖 Dưới đây là một số gợi ý xe sedan phổ biến mà bạn có thể tham khảo:

1. **Honda Civic**
2. **Toyota Camry**
3. **Hyundai Elantra**
4. **Mazda3**
5. **...

👤 Trong những xe này, xe nào tiết kiệm nhiên liệu nhất?
🔄 Processing question with 5 messages of context...
💭 Conversation context: {'session_id': 'session_20250628_112927', 'message_count': 6, 'context_summary': 'Đã tư vấn xe sedan', 'last_topics': ['Sedan', 'Tiết kiệm nhiên liệu']}
🤖 Trong danh sách gợi ý xe sedan, **Honda Civic** thường được biết đến là một trong những mẫu xe tiết kiệm nhiên liệu nhất. Mẫu xe này có hiệu suất nhiê...


2. Understanding References
----------------------------------------
🔄 Conversation context has been reset.
👤 Tôi quan tâm đến Honda Civic
🔄 Processing question with 1 messages of context...
💭 Conversation context: {'session_id': 'session_20250628_112927', 'message_count': 2, 'context_summary': '', 'last_topics': []}
🤖 Honda Civic là một mẫu xe sedan rất phổ biến và được ưa chuộng. Bạn muốn biết thêm thông tin gì về Honda Civic? Có phải bạn đang tìm kiếm gợi ý về phi...

👤 Nó có đắt không?
🔄 Processing question with 3 messages of context...
💭 Conversation context: {'session_id': 'session_20250628_112927', 'message_count': 4, 'context_summary': '', 'last_topics': []}
🤖 Giá của Honda Civic có thể thay đổi tùy thuộc vào phiên bản, trang bị và khu vực bạn đang sống. Thông thường, giá của Honda Civic mới sẽ dao động từ k...

👤 Khi nào tôi nên bảo dưỡng nó?
🔄 Processing question with 5 messages of context...
💭 Conversation context: {'session_id': 'session_20250628_112927', 'message_count': 6, 'context_summary': '', 'last_topics': ['Bảo dưỡng']}
🤖 Lịch bảo dưỡng cho Honda Civic thường bao gồm các dịch vụ như thay dầu, kiểm tra phanh, và xoay lốp. Dưới đây là một số thời điểm quan trọng bạn nên c...


3. Maintaining Topic Flow
----------------------------------------
🔄 Conversation context has been reset.
👤 Cho tôi mẹo tiết kiệm nhiên liệu
🔄 Processing question with 1 messages of context...
🔧 Executing function: get_fuel_efficiency_tips with args: {}
🔄 Getting contextualized final response...
💭 Conversation context: {'session_id': 'session_20250628_112927', 'message_count': 4, 'context_summary': '', 'last_topics': ['Tiết kiệm nhiên liệu']}
🤖 Dưới đây là một số mẹo giúp bạn tiết kiệm nhiên liệu:

1. Duy trì tốc độ ổn định, tránh tăng tốc đột ngột.
2. Kiểm tra áp suất lốp định kỳ.
3. Loại bỏ...

👤 Mẹo nào quan trọng nhất?
🔄 Processing question with 5 messages of context...
💭 Conversation context: {'session_id': 'session_20250628_112927', 'message_count': 6, 'context_summary': '', 'last_topics': ['Tiết kiệm nhiên liệu']}
🤖 Mặc dù tất cả các mẹo đều quan trọng, nhưng việc **duy trì tốc độ ổn định và tránh tăng tốc đột ngột** có thể được coi là một trong những yếu tố quan ...

👤 Còn về áp suất lốp thì sao?
🔄 Processing question with 7 messages of context...
💭 Conversation context: {'session_id': 'session_20250628_112927', 'message_count': 8, 'context_summary': '', 'last_topics': []}
🤖 Kiểm tra **áp suất lốp định kỳ** cũng rất quan trọng để tiết kiệm nhiên liệu. Áp suất lốp thích hợp giúp xe vận hành hiệu quả hơn và giảm ma sát với m...


================================================================================
✨ SUMMARY
================================================================================

🚫 WITHOUT Context Management:
- Mỗi câu hỏi độc lập
- Không hiểu references ("nó", "xe đó")
- Không nhớ đã nói gì trước đó
- Trải nghiệm như chat với người lạ mỗi lần

✅ WITH Context Management:
- Nhớ toàn bộ cuộc trò chuyện
- Hiểu references và pronouns
- Duy trì flow tự nhiên
- Trải nghiệm như nói chuyện với một người
    
================================================================================